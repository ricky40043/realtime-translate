# 多語言即時聊天應用 - 使用說明書

## 🌟 應用簡介

這是一個支持多語言實時翻譯的聊天應用，具備語音轉文字、即時翻譯和多用戶協作功能。支持手機和桌面設備，提供響應式用戶界面。

## 🌐 當前可用網址

```
https://f4050081f588.ngrok-free.app
```

> ⚠️ **注意**: ngrok 網址會在重啟後變更，請使用 `./get-url.sh` 獲取最新網址。

## 📱 功能頁面

### 1. 翻譯測試首頁 (Room/Home)  
**網址**: https://231aca8edee1.ngrok-free.app/room

**功能特色**:
- 🌍 **多語言翻譯測試**: 支持12種語言互譯
- 🎤 **語音翻譯**: 按住說話進行語音輸入和翻譯
- 📝 **文字翻譯**: 支持鍵盤文字輸入翻譯
- 🚀 **創建房間**: 一鍵創建多用戶聊天房間
- 📱 **手機優化**: 完全響應式設計

**支持語言**:
- 繁體中文、簡體中文、English、日本語、한국어
- Español、Français、Deutsch
- 緬甸文 (မြန်မာ)、印尼文 (Bahasa Indonesia)
- 馬來文 (Bahasa Melayu)、廣東話

**操作說明**:
1. 選擇源語言和目標語言
2. 使用語音或文字進行翻譯測試
3. 點擊「🚀 創建房間」按鈕建立多用戶房間

### 2. 用戶模式 (User View)
**網址**: https://231aca8edee1.ngrok-free.app/user/:roomID

**功能特色**:
- 🎤 **語音輸入**: 按住說話按鈕進行語音輸入
- 🌍 **個人字幕**: 根據您的慣用語顯示翻譯字幕
- ⚙️ **語言設定**: 可設定慣用語和主板顯示語言
- 📱 **手機優化**: 語音按鈕在手機上清楚可見

**操作說明**:
1. 通過分享連結或 QR 碼加入房間
2. 設定您的慣用語（個人字幕語言）
3. 使用語音與其他用戶交流
4. 查看即時翻譯字幕

### 3. 主板模式 (Host Board)
**網址**: https://231aca8edee1.ngrok-free.app/host/:roomID

**功能特色**:
- 📺 **主板顯示**: 大屏幕顯示所有翻譯後的訊息
- 👥 **用戶管理**: 顯示在線用戶數量
- 🔗 **分享房間**: 生成 QR 碼和短網址邀請用戶
- 📊 **即時統計**: 顯示訊息數量和連線狀態

**操作說明**:
1. 創建房間後自動跳轉到主板
2. 點擊「分享房間」按鈕生成邀請連結和 QR 碼
3. 所有用戶的發言會即時顯示在主板上
4. 支持多語言翻譯顯示

## 🎤 語音功能使用指南

### 語音輸入步驟
1. **授權麥克風**: 首次使用會要求麥克風權限
2. **按住說話**: 長按語音按鈕開始錄音
3. **放開完成**: 釋放按鈕完成錄音
4. **自動處理**: 系統自動進行語音轉文字和翻譯

### 支持語言
- 🇹🇼 繁體中文 (zh-TW)
- 🇨🇳 簡體中文 (zh-CN)
- 🇺🇸 英語 (en)
- 🇯🇵 日語 (ja)
- 🇰🇷 韓語 (ko)
- 🇪🇸 西班牙語 (es)
- 🇫🇷 法語 (fr)
- 🇩🇪 德語 (de)

## 📱 手機使用指南

### 手機版優化功能
- ✅ **大按鈕設計**: 語音按鈕針對觸控優化
- ✅ **響應式布局**: 自動適應螢幕大小
- ✅ **觸控友好**: 所有按鈕符合手機觸控標準
- ✅ **垂直布局**: 手機版採用垂直排列
- ✅ **大字體**: 適合手機閱讀的字體大小

### 手機操作技巧
1. **語音輸入**: 長按語音按鈕，確保授權麥克風權限
2. **頁面縮放**: 支持手機瀏覽器的縮放功能
3. **橫豎屏**: 支持橫豎屏切換
4. **觸控滾動**: 支持觸控滾動查看歷史訊息

## 🔧 技術架構

### 前端技術
- **Vue.js 3**: 響應式前端框架
- **TypeScript**: 類型安全的 JavaScript
- **Vite**: 快速構建工具
- **響應式 CSS**: 手機優先設計

### 後端技術
- **FastAPI**: Python 高性能 API 框架
- **WebSocket**: 即時通訊
- **PostgreSQL**: 關聯式資料庫
- **Redis**: 快取和會話管理

### 基礎設施
- **Docker**: 容器化部署
- **nginx**: 反向代理和靜態文件服務 (透過 volume 掛載前端構建文件)
- **ngrok**: 對外網址隧道

## 🚀 一鍵部署指南

### 快速啟動

#### 方法 1: 使用管理腳本 (推薦)
```bash
# 完整重啟所有服務
./restart-all.sh

# 或僅重啟 ngrok (如果 Docker 和前端已在運行)
./start-ngrok.sh

# 獲取當前網址
./get-url.sh
```

#### 方法 2: 使用原始部署腳本
```bash
# 使用快速部署腳本
./quick-deploy-ngrok.sh
```

#### 方法 3: 手動啟動
```bash
# 1. 啟動 Docker
docker-compose up -d

# 2. 啟動前端
cd frontend && npm run dev &

# 3. 啟動 ngrok
ngrok http 80 &

# 4. 獲取網址
./get-url.sh
```

### 手動部署
```bash
# 1. 啟動 Docker 服務
docker-compose up --build -d

# 2. 啟動前端開發服務
cd frontend && npm run dev &

# 3. 啟動 ngrok 隧道
ngrok http 80

# 4. 獲取 ngrok 網址
curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url'
```

### ngrok 管理指令

#### 基本指令
```bash
# 啟動 ngrok 隧道
ngrok http 80

# 在背景啟動 ngrok
ngrok http 80 > /dev/null 2>&1 &

# 獲取當前 ngrok 網址
curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url'

# 查看 ngrok 狀態和所有隧道
curl -s http://localhost:4040/api/tunnels | jq

# 停止 ngrok
pkill ngrok

# 重啟 ngrok (會生成新網址)
pkill ngrok && sleep 2 && ngrok http 80 &

# 查看 ngrok Web 管理界面
open http://localhost:4040
```

#### 自動化管理腳本
**已提供三個管理腳本，讓 ngrok 管理更簡單：**

##### 1. `get-url.sh` - 獲取當前網址
```bash
./get-url.sh
```
**功能特色**:
- 🌐 顯示當前 ngrok 網址
- 📋 自動複製到剪貼簿 (macOS/Linux)
- 🧪 測試連接狀態
- 📱 提供完整的測試連結
- 🎨 彩色輸出界面

##### 2. `restart-all.sh` - 完整重啟所有服務
```bash
./restart-all.sh
```
**功能特色**:
- 🛑 優雅停止所有服務 (Docker + Frontend + ngrok)
- 🚀 按順序重新啟動所有服務
- ⏱️ 適當等待時間確保服務穩定
- 📊 顯示服務狀態總結
- 📝 提供日誌文件位置

##### 3. `start-ngrok.sh` - 快速重啟 ngrok
```bash
./start-ngrok.sh
```
**功能特色**:
- 🔍 檢查依賴服務狀態
- 🔄 僅重啟 ngrok 隧道
- ⚡ 自動啟動缺少的依賴服務
- 🌐 顯示新的網址信息

### 停止服務
```bash
# 使用停止腳本
./stop-quick.sh

# 或手動停止所有服務
docker-compose down
pkill ngrok
pkill -f "npm run dev"
```

## 🔗 分享和協作

### 邀請用戶參與
1. 進入主板模式: https://04537c7e118f.ngrok-free.app/host
2. 點擊「分享用戶連結」按鈕
3. 將連結發送給其他用戶
4. 用戶點擊連結即可加入聊天

### 多用戶測試建議
1. **主持人**: 使用主板模式管理聊天室
2. **參與者**: 使用用戶模式參與聊天
3. **語言測試**: 不同用戶使用不同語言測試翻譯功能
4. **設備測試**: 同時使用手機和電腦測試兼容性

## 🛠️ 故障排除

### 常見問題

#### 1. ngrok 網址無法訪問
- **症狀**: 404 或 502 錯誤
- **原因**: ngrok 隧道斷線或前端服務未啟動
- **解決方案**:
  ```bash
  # 檢查 ngrok 狀態
  curl -s http://localhost:4040/api/tunnels
  
  # 重新啟動 ngrok
  pkill ngrok && ngrok http 80 &
  
  # 檢查前端服務
  ps aux | grep "npm run dev"
  cd frontend && npm run dev &
  ```

#### 2. 編譯錯誤 (Vue/TypeScript)
- **症狀**: 前端頁面空白或編譯失敗
- **原因**: 重複函數定義或語法錯誤
- **解決方案**:
  ```bash
  # 重新安裝依賴
  cd frontend && npm install
  
  # 重新啟動開發服務
  pkill -f "npm run dev"
  npm run dev
  ```

#### 3. 語音按鈕不可見
- **檢查**: 確認使用手機瀏覽器訪問
- **解決**: 重新加載頁面，確保 CSS 正確載入

#### 4. 麥克風無法使用
- **檢查**: 瀏覽器麥克風權限
- **解決**: 在瀏覽器設定中允許麥克風權限

#### 5. WebSocket 連接失敗
- **症狀**: 顯示「連線中...」且房間人數為 0
- **原因**: WebSocket URL 配置錯誤
- **解決方案**:
  ```bash
  # 檢查後端服務
  docker-compose logs backend
  
  # 重啟 nginx 代理
  docker-compose restart nginx
  ```

#### 6. 翻譯功能異常
- **檢查**: 語言設定是否正確
- **解決**: 重新設定源語言和目標語言

### 服務管理命令

```bash
# 查看服務狀態
docker-compose ps

# 查看日誌
docker-compose logs -f

# 重啟特定服務
docker-compose restart nginx
docker-compose restart backend

# 查看前端開發服務狀態
ps aux | grep "npm run dev"

# 重啟前端服務
pkill -f "npm run dev" && cd frontend && npm run dev &
```

### ngrok 網址管理

```bash
# 獲取當前網址並保存
NEW_URL=$(curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url')
echo "當前網址: $NEW_URL"

# 複製網址到剪貼簿 (macOS)
curl -s http://localhost:4040/api/tunnels | jq -r '.tunnels[0].public_url' | pbcopy

# 測試網址是否正常
curl -I "$NEW_URL/health"

# 更新使用說明書中的網址 (手動替換)
echo "請手動更新使用說明書中的網址為: $NEW_URL"
```

### ngrok 使用場景和最佳實踐

#### 日常開發使用
```bash
# 開始工作 - 獲取當前網址
./get-url.sh

# 分享給測試者
./get-url.sh  # 網址會自動複製到剪貼簿

# 服務出現問題時
./restart-all.sh  # 完整重啟解決大部分問題

# 僅 ngrok 斷線時
./start-ngrok.sh  # 快速重建隧道
```

#### 腳本管理文件
**項目根目錄已包含三個管理腳本：**

- **`get-url.sh`** - 網址獲取和狀態檢查
- **`restart-all.sh`** - 完整服務重啟
- **`start-ngrok.sh`** - 快速 ngrok 重啟

#### 故障排除流程
```bash
# 1. 檢查當前狀態
./get-url.sh

# 2. 如果服務異常，完整重啟
./restart-all.sh

# 3. 如果只是網址問題，快速重啟 ngrok
./start-ngrok.sh

# 4. 檢查日誌文件
cat frontend.log    # 前端服務日誌
cat ngrok.log       # ngrok 日誌
docker-compose logs # Docker 服務日誌
```

## 🔒 安全須知

### 隱私保護
- 語音數據僅用於即時轉換，不會儲存
- 聊天記錄保存在本地資料庫
- ngrok 隧道為臨時性，重啟後網址會變更

### ngrok 安全注意事項
- ngrok 免費版會顯示警告頁面，用戶需點擊「Visit Site」
- 網址會在重啟後變更，避免分享過期連結
- 適合開發測試，生產環境請使用正式域名

### 使用建議
- 適合內部測試和演示使用
- 生產環境建議使用正式域名和 SSL 證書
- 定期更新依賴套件確保安全性
- 使用腳本自動化管理 ngrok 網址

## 📊 功能特色總結

### ✅ 已實現功能
- 🎤 語音轉文字 (支援12種語言)
- 🌍 即時翻譯 (包含亞洲語言：緬甸文、印尼文、馬來文、廣東話)
- 💬 多用戶即時聊天 (WebSocket)
- 👥 房間管理系統 (創建、分享、QR碼)
- 📱 手機響應式設計 (語音按鈕優化)
- 🔄 一鍵部署腳本
- 🌐 ngrok 外部網址管理
- 🏠 翻譯測試首頁

### 🚧 開發中功能 (TODO)
- ✅ 路由/room 改為翻譯測試首頁
- ✅ 創建房間按鈕和跳轉功能
- ⏳ /host/:roomID 分享房間功能和 QR 碼
- ⏳ /user/:roomID 移除文字輸入框
- ⏳ 翻譯效能優化 (避免重複翻譯)

### 🎯 適用場景
- 多語言會議和研討會
- 國際團隊協作
- 語言學習和練習
- 跨文化交流活動
- 即時翻譯演示
- 東南亞多語言溝通

## 📞 技術支持

### 常用管理指令速查
```bash
# 快速檢查狀態
./get-url.sh

# 服務出問題時
./restart-all.sh

# 僅網址失效時
./start-ngrok.sh

# 查看服務狀態
docker-compose ps

# 查看日誌
docker-compose logs -f
cat frontend.log
cat ngrok.log
```

### 故障排除步驟
1. **檢查當前狀態**: `./get-url.sh`
2. **查看 Docker 容器日誌**: `docker-compose logs`
3. **檢查 ngrok 連線狀態**: `curl http://localhost:4040/api/tunnels`
4. **重啟相關服務**: `./restart-all.sh`
5. **查看瀏覽器開發者工具**: F12 檢查網路和控制台錯誤

## 📈 開發進度

### 當前版本: v1.2.0

#### ✅ v1.2.0 更新內容 (2025年10月6日)
- 🏠 重構 /room 為翻譯測試首頁
- 🚀 添加一鍵創建房間功能
- 🌏 新增4種亞洲語言支持
- 📱 優化手機版語音按鈕
- 🔧 修復編譯錯誤和函數重複定義
- 📖 完善 ngrok 管理文檔

#### 🎯 下一版本計劃 (v1.3.0)
- 🔗 實現分享房間功能和 QR 碼生成
- ⚡ 優化翻譯效能
- 📝 移除用戶頁面文字輸入框
- 🎨 UI/UX 進一步優化

### 快速更新指令
```bash
# 獲取最新代碼
git pull origin main

# 重新構建並啟動
./restart-all.sh

# 獲取新網址
./get-url.sh
```

---

**最後更新**: 2025年10月6日  
**當前版本**: v1.2.0  
**技術棧**: Vue.js 3 + TypeScript + FastAPI + Docker + nginx + ngrok  
**支持語言**: 12種 (包含東南亞語言)  
**部署方式**: Docker + ngrok 一鍵部署